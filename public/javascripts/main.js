// Generated by CoffeeScript 1.6.2
(function() {
  "use strict";
  var app;

  app = angular.module("jstracker", ["jstracker.services", "jstracker.directives"]);

  app.config([
    "$routeProvider", function($routeProvider) {
      return $routeProvider.when("/", {
        controller: "HostListController",
        resolve: {
          hosts: function(MultiHostLoader) {
            return MultiHostLoader();
          }
        },
        templateUrl: "/list.html"
      }).when("/hosts/:hostId/types/:type/browsers/:browser", {
        controller: "HostController",
        resolve: {
          host: function(HostLoader) {
            return HostLoader();
          }
        },
        templateUrl: "/host.html"
      }).when("/msgs/:msgId", {
        controller: "MsgController",
        resolve: {
          msg: function(MsgLoader) {
            return MsgLoader();
          }
        },
        templateUrl: "/msg.html"
      });
    }
  ]);

  app.controller("HostListController", [
    "$scope", "$location", "hosts", function($scope, $location, hosts) {
      return $scope.hosts = hosts;
    }
  ]);

  app.controller("HostController", [
    "$scope", "$location", "$route", "$http", "host", function($scope, $location, $route, $http, host) {
      $scope.host = host;
      $scope.t = $route.current.params.type;
      $scope.b = $route.current.params.browser;
      $scope.setBrowser = function(b) {
        return $location.path("/hosts/" + host.id + "/types/" + $route.current.params.type + "/browsers/" + b);
      };
      $scope.setType = function(t) {
        return $location.path("/hosts/" + host.id + "/types/" + t + "/browsers/" + $route.current.params.browser);
      };
      $scope.changeType = function(msg, typeId) {
        var url;

        url = "/msgs/" + msg.id + "/changetype/?type_id=" + typeId;
        return $http.get(url).success(function(data, status) {
          var types;

          if (typeId !== msg.type_id) {
            angular.element("#J_Msg_" + msg.id).hide();
          }
          types = ["open", "closed", "ignored"];
          host.types[types[msg.type_id - 1]] -= 1;
          return host.types[types[typeId - 1]] += 1;
        });
      };
      setTimeout(function() {
        return angular.element("div.sparkline span").peity("line");
      });
      return 0;
    }
  ]);

  app.controller("MsgController", [
    "$scope", "msg", function($scope, msg) {
      return $scope.msg = msg;
    }
  ]);

}).call(this);
